<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>面對面翻譯助手</title>
    
    <!-- PWA 相關標籤 -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="翻譯助手">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 安裝提示樣式 */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            width: 320px;
        }
        
        .install-prompt p {
            margin: 0 0 10px 0;
        }
        
        .install-prompt .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .install-prompt button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .install-prompt .install-btn {
            background: #2196F3;
            color: white;
        }
        
        .install-prompt .close-btn {
            background: #e0e0e0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 上半部分（翻轉區域） -->
        <div class="split-section top-section">
            <div id="chatContainer-top" class="chat-container"></div>
            <div class="control-panel">
                <select class="language-select">
                    <option value="zh-TW">中文（台灣）</option>
                    <option value="zh-CN">漢語（中國）</option>
                    <option value="yue">粵語（香港）</option>
                    <option value="en-US">English</option>
                    <option value="ja-JP">日本語</option>
                    <option value="ko-KR">한국어</option>
                    <option value="th-TH">ภาษาไทย</option>
                    <option value="vi-VN">Tiếng Việt</option>
                    <option value="fr-FR">Français</option>
                    <option value="es-ES">Español</option>
                </select>
                <button class="btn btn-record">
                    <span class="status-indicator"></span>
                    開始對話
                </button>
            </div>
        </div>

        <!-- 下半部分 -->
        <div class="split-section bottom-section">
            <div id="chatContainer-bottom" class="chat-container"></div>
            <div class="control-panel">
                <select class="language-select">
                    <option value="en-US">English</option>
                    <option value="zh-TW">中文（台灣）</option>
                    <option value="zh-CN">漢語（中國）</option>
                    <option value="yue">粵語（香港）</option>
                    <option value="ja-JP">日本語</option>
                    <option value="ko-KR">한국어</option>
                    <option value="th-TH">ภาษาไทย</option>
                    <option value="vi-VN">Tiếng Việt</option>
                    <option value="fr-FR">Français</option>
                    <option value="es-ES">Español</option>
                </select>
                <button class="btn btn-record">
                    <span class="status-indicator"></span>
                    Start Speaking
                </button>
            </div>
        </div>
    </div>

    <!-- 安裝提示 -->
    <div class="install-prompt" id="installPrompt">
        <p>將翻譯助手添加到主畫面，隨時使用！</p>
        <div class="buttons">
            <button class="install-btn" id="installBtn">安裝應用</button>
            <button class="close-btn" id="closePromptBtn">稍後再說</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // PWA 安裝相關代碼
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // 阻止 Chrome 67 及更早版本自動顯示安裝提示
            e.preventDefault();
            // 保存安裝提示事件
            deferredPrompt = e;
            // 顯示自定義安裝提示
            document.getElementById('installPrompt').style.display = 'block';
        });
        
        // 處理安裝按鈕點擊
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                // 顯示安裝提示
                deferredPrompt.prompt();
                // 等待用戶回應
                const { outcome } = await deferredPrompt.userChoice;
                // 清理提示
                deferredPrompt = null;
                // 隱藏提示框
                document.getElementById('installPrompt').style.display = 'none';
            } else {
                // 如果在iOS設備上
                if (navigator.standalone !== undefined) {
                    alert('請點擊分享按鈕，然後選擇"加入主畫面"選項來安裝應用');
                }
            }
        });
        
        // 處理關閉按鈕點擊
        document.getElementById('closePromptBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });
        
        // 檢查是否已經安裝
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('installPrompt').style.display = 'none';
        }
    </script>
</body>
</html>
